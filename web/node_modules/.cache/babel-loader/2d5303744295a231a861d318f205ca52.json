{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Ahmed\\\\Desktop\\\\OrthoDoc\\\\web\\\\src\\\\Pages\\\\Message.js\",\n    _s = $RefreshSig$();\n\n// import { collection, getDocs } from \"firebase/firestore\";\n// import { doc, setDoc } from \"firebase/firestore\";\n// import { query, where } from \"firebase/firestore\";\n// import { useLocation } from 'react-router-dom';\n// import { authentication, db } from '../firebase-config';\n// import { useState, useEffect } from \"react\";\n// import Messenger from \"./Messenger\";\n// import { Link } from \"react-router-dom\";\n// import { FaArrowCircleLeft } from \"react-icons/fa\";\n// import { MdSend } from \"react-icons/md\";\n// function Message() {\n//   const location = useLocation();\n//   const [messages, setMessages] = useState([]);\n//   const [temp, setTemp] = useState(\"\");\n//   let messageArraay = [];\n//   const querySnapshot = async () => {\n//     console.log(\"State\", location.state.docid);\n//     const col = collection(db, \"chatroom\");\n//     const q = query(\n//       col,\n//       where(\n//         \"chatId\",\n//         \"==\",\n//         location.state.userid + location.state.docid\n//       )\n//     );\n//     const snap = await getDocs(q);\n//     snap.forEach((doc) => {\n//       const new_obj = {\n//         ...doc.data(),\n//         //createdAt: doc.data().createdAt.toDate().getTime(),\n//       };\n//       messageArraay.push(new_obj);\n//     });\n//     console.log(\"message array\", messageArraay);\n//     setMessages(messageArraay.reverse());\n//     console.log(\"REVERSE\",messageArraay.reverse())\n//     console.log(\"msgs array\", messages)\n//   };\n//   useEffect(() => {\n//     //console.log(props.route);\n//     querySnapshot();\n//   }, []);\n//   const onSend = (messageArray) => {\n//     const msg = messageArray[0];\n//     const mymsg = {\n//       ...msg,\n//       sentBy:\n//         location.state.current == \"doctor\"\n//           ? location.state.docid\n//           : location.state.userid,\n//       sentTo:\n//         location.state.current == \"doctor\"\n//           ? location.state.userid\n//           : location.state.docid,\n//       craetedAt: new Date(),\n//       chatId:\n//         location.state.userid + location.state.docid,\n//     };\n//     //setMessages((previousMessages) =>\n//     // setTemp((prev) => [...prev, mymsg]);\n//     //temp.append(previousMessages,mymsg);\n//     //GiftedChat.append(previousMessages, mymsg)\n//     //console.log(\"set messages\"+temp);\n//     //);\n//     setMessages((previousMessages) =>\n//       messageArraay.push((previousMessages) => [...previousMessages, mymsg])\n//     );\n//     //console.log(\"temppp\",temp);\n//     const docid =\n//       location.state.docid > location.state.userid\n//         ? location.state.userid +\n//         \"-\" +\n//         location.state.docid\n//         : location.state.docid +\n//         \"-\" +\n//         location.state.userid;\n//     const myDoc = doc(db, \"chatroom\", new Date().toString());\n//     setDoc(myDoc, mymsg)\n//       .then(() => {\n//         console.log(\"Document written with ID: \", myDoc.id);\n//       })\n//       .catch((error) => {\n//         console.error(\"Error adding document: \", error.message);\n//       });\n//   };\n//   console.log(\"Doc id :\", location.state.docid)\n//   console.log(\"User id\", location.state.userid)\n//   console.log(\"temppp\", messages);\n//   return (\n//     <>\n//       <div className=\"messenger\">\n//         <div className=\"chatBox\">\n//           <div className=\"chatBoxWrapper\">\n//               <div className='chatBoxTop'>\n//               {messages.map((item, uid) => (\n//                  <div className=\"messages\">\n//                 <div className={`msg ${item.sentBy== authentication.currentUser.email? 'sent' : 'received'}`}>\n//                   <p className=\"P\">{item.text} </p>\n//                 </div></div>\n//               ))}\n//               </div>\n//               <div className=\"chatBoxBottom\">\n//                 <input className=\"chatMessageInput\"  onChange={(e) => setTemp(e.target.value)}  placeholder=\"Write something..\"></input>\n//                 <button className=\"chatSubmitButton\" onClick={(temp)=>onSend(messages)}>\n//                   <div className='sendicon'>  <MdSend /></div>\n//                 </button>\n//               </div>\n//           </div>\n//         </div>\n//       </div>\n//       <Link to='/home'>\n//         <div className='backtohome'><FaArrowCircleLeft /></div></Link>\n//     </>\n//   );\n// }\n// export default Message; \nimport { collection, getDocs, orderBy } from \"firebase/firestore\";\nimport { doc, setDoc } from \"firebase/firestore\";\nimport { query, where } from \"firebase/firestore\";\nimport { useLocation } from 'react-router-dom';\nimport { authentication, db } from '../firebase-config';\nimport { useState, useEffect } from \"react\";\nimport Messenger from \"./Messenger\";\nimport { Link } from \"react-router-dom\";\nimport { FaArrowCircleLeft } from \"react-icons/fa\";\nimport { MdSend } from \"react-icons/md\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Message() {\n  _s();\n\n  const location = useLocation();\n  const [messages, setMessages] = useState([]);\n  const [temp, setTemp] = useState(\"\");\n  let messageArraay = [];\n\n  const querySnapshot = async () => {\n    console.log(\"State\", location.state.docid);\n    const col = collection(db, \"chatroom\");\n    const q = query(col, where(\"chatId\", \"==\", location.state.userid + location.state.docid), orderBy(\"createdAt\", \"asc\"));\n    const snap = await getDocs(q);\n    snap.forEach(doc => {\n      const new_obj = { ...doc.data()\n      };\n      messageArraay.push(new_obj);\n    });\n    console.log(\"message array\", messageArraay);\n    setMessages(messageArraay);\n    console.log(\"REVERSE\", messageArraay.reverse());\n  };\n\n  useEffect(() => {\n    querySnapshot();\n  }, []);\n\n  const onSend = messages => {\n    const msg = messages[0];\n    const mymsg = { ...msg,\n      sentBy: location.state.current == \"doctor\" ? location.state.docid : location.state.userid,\n      sentTo: location.state.current == \"doctor\" ? location.state.userid : location.state.docid,\n      createdAt: new Date(),\n      chatId: location.state.userid + location.state.docid,\n      text: temp\n    };\n    setMessages(previousMessages => [...previousMessages, mymsg]);\n    const docid = location.state.docid > location.state.userid ? location.state.userid + \"-\" + location.state.docid : location.state.docid + \"-\" + location.state.userid;\n    const myDoc = doc(db, \"chatroom\", new Date().toString());\n    setDoc(myDoc, mymsg).then(() => {\n      console.log(\"Document written with ID: \", myDoc.id);\n    }).catch(error => {\n      console.error(\"Error adding document: \", error.message);\n    });\n  };\n\n  console.log(\"Doc id :\", location.state.docid);\n  console.log(\"User id\", location.state.userid);\n  console.log(\"temppp\", messages);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messenger\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatBox\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chatBoxWrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chatBoxTop\",\n            children: messages.map((item, uid) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"messages\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `msg ${item.sentBy == authentication.currentUser.email ? 'sent' : 'received'}`,\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"P\",\n                  children: [item.text, \" \"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 244,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"date-msg\",\n                  children: item.createdAt.toDate().toString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 243,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chatBoxBottom\",\n            children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n              className: \"chatMessageInput\",\n              onChange: e => setTemp(e.target.value),\n              placeholder: \"Write something..\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"chatSubmitButton\",\n              onClick: () => onSend(messages),\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"sendicon\",\n                children: [\"  \", /*#__PURE__*/_jsxDEV(MdSend, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 253,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      to: \"/home\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"backtohome\",\n        children: /*#__PURE__*/_jsxDEV(FaArrowCircleLeft, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 37\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Message, \"ZzmPzeMCW97UlTg1Zs8rUup1CtU=\", false, function () {\n  return [useLocation];\n});\n\n_c = Message;\nexport default Message;\n\nvar _c;\n\n$RefreshReg$(_c, \"Message\");","map":{"version":3,"sources":["C:/Users/Ahmed/Desktop/OrthoDoc/web/src/Pages/Message.js"],"names":["collection","getDocs","orderBy","doc","setDoc","query","where","useLocation","authentication","db","useState","useEffect","Messenger","Link","FaArrowCircleLeft","MdSend","Message","location","messages","setMessages","temp","setTemp","messageArraay","querySnapshot","console","log","state","docid","col","q","userid","snap","forEach","new_obj","data","push","reverse","onSend","msg","mymsg","sentBy","current","sentTo","createdAt","Date","chatId","text","previousMessages","myDoc","toString","then","id","catch","error","message","map","item","uid","currentUser","email","toDate","e","target","value"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AAEA;AAEA;AACA;AAKA,SAASA,UAAT,EAAqBC,OAArB,EAA8BC,OAA9B,QAA6C,oBAA7C;AACA,SAASC,GAAT,EAAcC,MAAd,QAA4B,oBAA5B;AACA,SAASC,KAAT,EAAgBC,KAAhB,QAA6B,oBAA7B;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,cAAT,EAAyBC,EAAzB,QAAmC,oBAAnC;AACA,SAASC,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,SAASC,iBAAT,QAAkC,gBAAlC;AACA,SAASC,MAAT,QAAuB,gBAAvB;;;;AACA,SAASC,OAAT,GAAmB;AAAA;;AACjB,QAAMC,QAAQ,GAAGV,WAAW,EAA5B;AACA,QAAM,CAACW,QAAD,EAAWC,WAAX,IAA0BT,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACU,IAAD,EAAOC,OAAP,IAAkBX,QAAQ,CAAC,EAAD,CAAhC;AAGA,MAAIY,aAAa,GAAG,EAApB;;AACA,QAAMC,aAAa,GAAG,YAAY;AAChCC,I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","sourcesContent":["// import { collection, getDocs } from \"firebase/firestore\";\r\n// import { doc, setDoc } from \"firebase/firestore\";\r\n// import { query, where } from \"firebase/firestore\";\r\n// import { useLocation } from 'react-router-dom';\r\n// import { authentication, db } from '../firebase-config';\r\n// import { useState, useEffect } from \"react\";\r\n// import Messenger from \"./Messenger\";\r\n// import { Link } from \"react-router-dom\";\r\n// import { FaArrowCircleLeft } from \"react-icons/fa\";\r\n// import { MdSend } from \"react-icons/md\";\r\n// function Message() {\r\n//   const location = useLocation();\r\n//   const [messages, setMessages] = useState([]);\r\n//   const [temp, setTemp] = useState(\"\");\r\n\r\n//   let messageArraay = [];\r\n//   const querySnapshot = async () => {\r\n//     console.log(\"State\", location.state.docid);\r\n//     const col = collection(db, \"chatroom\");\r\n//     const q = query(\r\n//       col,\r\n//       where(\r\n//         \"chatId\",\r\n//         \"==\",\r\n//         location.state.userid + location.state.docid\r\n//       )\r\n//     );\r\n//     const snap = await getDocs(q);\r\n\r\n//     snap.forEach((doc) => {\r\n//       const new_obj = {\r\n//         ...doc.data(),\r\n//         //createdAt: doc.data().createdAt.toDate().getTime(),\r\n//       };\r\n\r\n//       messageArraay.push(new_obj);\r\n//     });\r\n//     console.log(\"message array\", messageArraay);\r\n//     setMessages(messageArraay.reverse());\r\n//     console.log(\"REVERSE\",messageArraay.reverse())\r\n//     console.log(\"msgs array\", messages)\r\n//   };\r\n//   useEffect(() => {\r\n//     //console.log(props.route);\r\n//     querySnapshot();\r\n//   }, []);\r\n//   const onSend = (messageArray) => {\r\n//     const msg = messageArray[0];\r\n//     const mymsg = {\r\n//       ...msg,\r\n//       sentBy:\r\n//         location.state.current == \"doctor\"\r\n//           ? location.state.docid\r\n//           : location.state.userid,\r\n//       sentTo:\r\n//         location.state.current == \"doctor\"\r\n//           ? location.state.userid\r\n//           : location.state.docid,\r\n\r\n//       craetedAt: new Date(),\r\n//       chatId:\r\n//         location.state.userid + location.state.docid,\r\n//     };\r\n//     //setMessages((previousMessages) =>\r\n//     // setTemp((prev) => [...prev, mymsg]);\r\n//     //temp.append(previousMessages,mymsg);\r\n//     //GiftedChat.append(previousMessages, mymsg)\r\n//     //console.log(\"set messages\"+temp);\r\n//     //);\r\n//     setMessages((previousMessages) =>\r\n//       messageArraay.push((previousMessages) => [...previousMessages, mymsg])\r\n//     );\r\n//     //console.log(\"temppp\",temp);\r\n//     const docid =\r\n//       location.state.docid > location.state.userid\r\n//         ? location.state.userid +\r\n//         \"-\" +\r\n//         location.state.docid\r\n//         : location.state.docid +\r\n//         \"-\" +\r\n//         location.state.userid;\r\n\r\n//     const myDoc = doc(db, \"chatroom\", new Date().toString());\r\n//     setDoc(myDoc, mymsg)\r\n//       .then(() => {\r\n//         console.log(\"Document written with ID: \", myDoc.id);\r\n//       })\r\n//       .catch((error) => {\r\n//         console.error(\"Error adding document: \", error.message);\r\n//       });\r\n//   };\r\n\r\n\r\n//   console.log(\"Doc id :\", location.state.docid)\r\n//   console.log(\"User id\", location.state.userid)\r\n//   console.log(\"temppp\", messages);\r\n//   return (\r\n//     <>\r\n\r\n//       <div className=\"messenger\">\r\n\r\n//         <div className=\"chatBox\">\r\n//           <div className=\"chatBoxWrapper\">\r\n\r\n//               <div className='chatBoxTop'>\r\n//               {messages.map((item, uid) => (\r\n//                  <div className=\"messages\">\r\n\r\n//                 <div className={`msg ${item.sentBy== authentication.currentUser.email? 'sent' : 'received'}`}>\r\n//                   <p className=\"P\">{item.text} </p>\r\n\r\n//                 </div></div>\r\n//               ))}\r\n//               </div>\r\n\r\n//               <div className=\"chatBoxBottom\">\r\n//                 <input className=\"chatMessageInput\"  onChange={(e) => setTemp(e.target.value)}  placeholder=\"Write something..\"></input>\r\n//                 <button className=\"chatSubmitButton\" onClick={(temp)=>onSend(messages)}>\r\n//                   <div className='sendicon'>  <MdSend /></div>\r\n//                 </button>\r\n//               </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//       </div>\r\n//       <Link to='/home'>\r\n//         <div className='backtohome'><FaArrowCircleLeft /></div></Link>\r\n\r\n\r\n\r\n\r\n//     </>\r\n\r\n//   );\r\n\r\n// }\r\n// export default Message; \r\n\r\n\r\n\r\n\r\nimport { collection, getDocs, orderBy } from \"firebase/firestore\";\r\nimport { doc, setDoc } from \"firebase/firestore\";\r\nimport { query, where } from \"firebase/firestore\";\r\nimport { useLocation } from 'react-router-dom';\r\nimport { authentication, db } from '../firebase-config';\r\nimport { useState, useEffect } from \"react\";\r\nimport Messenger from \"./Messenger\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { FaArrowCircleLeft } from \"react-icons/fa\";\r\nimport { MdSend } from \"react-icons/md\";\r\nfunction Message() {\r\n  const location = useLocation();\r\n  const [messages, setMessages] = useState([]);\r\n  const [temp, setTemp] = useState(\"\");\r\n\r\n\r\n  let messageArraay = [];\r\n  const querySnapshot = async () => {\r\n    console.log(\"State\", location.state.docid);\r\n    const col = collection(db, \"chatroom\");\r\n    const q = query(\r\n      col,\r\n      where(\r\n        \"chatId\",\r\n        \"==\",\r\n        location.state.userid + location.state.docid\r\n      ), orderBy(\"createdAt\", \"asc\")\r\n    );\r\n    const snap = await getDocs(q);\r\n\r\n    snap.forEach((doc) => {\r\n      const new_obj = {\r\n        ...doc.data(),\r\n      };\r\n\r\n      messageArraay.push(new_obj);\r\n    });\r\n    console.log(\"message array\", messageArraay);\r\n    setMessages(messageArraay);\r\n    console.log(\"REVERSE\", messageArraay.reverse())\r\n  };\r\n  useEffect(() => {\r\n    querySnapshot();\r\n  }, []);\r\n  const onSend = (messages) => {\r\n    const msg = messages[0];\r\n    const mymsg = {\r\n      ...msg,\r\n      sentBy:\r\n        location.state.current == \"doctor\"\r\n          ? location.state.docid\r\n          : location.state.userid,\r\n      sentTo:\r\n        location.state.current == \"doctor\"\r\n          ? location.state.userid\r\n          : location.state.docid,\r\n\r\n      createdAt: new Date(),\r\n      chatId:\r\n        location.state.userid + location.state.docid,\r\n      text: temp,\r\n    };\r\n\r\n    setMessages((previousMessages) => [...previousMessages, mymsg]\r\n    );\r\n\r\n    const docid =\r\n      location.state.docid > location.state.userid\r\n        ? location.state.userid +\r\n        \"-\" +\r\n        location.state.docid\r\n        : location.state.docid +\r\n        \"-\" +\r\n        location.state.userid;\r\n\r\n    const myDoc = doc(db, \"chatroom\", new Date().toString());\r\n    setDoc(myDoc, mymsg)\r\n      .then(() => {\r\n        console.log(\"Document written with ID: \", myDoc.id);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error adding document: \", error.message);\r\n      });\r\n  };\r\n\r\n\r\n  console.log(\"Doc id :\", location.state.docid)\r\n  console.log(\"User id\", location.state.userid)\r\n  console.log(\"temppp\", messages);\r\n  return (\r\n    <>\r\n\r\n      <div className=\"messenger\">\r\n\r\n        <div className=\"chatBox\">\r\n          <div className=\"chatBoxWrapper\">\r\n\r\n            <div className='chatBoxTop'>\r\n              {messages.map((item, uid) => (\r\n                <div className=\"messages\">\r\n\r\n                  <div className={`msg ${item.sentBy == authentication.currentUser.email ? 'sent' : 'received'}`}>\r\n                    <p className=\"P\">{item.text} </p>\r\n                    <p className=\"date-msg\">{item.createdAt.toDate().toString()}</p>\r\n                  </div></div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"chatBoxBottom\">\r\n              <textarea className=\"chatMessageInput\" onChange={(e) => setTemp(e.target.value)} placeholder=\"Write something..\"></textarea>\r\n              <button className=\"chatSubmitButton\" onClick={() => onSend(messages)}>\r\n                <div className='sendicon'>  <MdSend /></div>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n      <Link to='/home'>\r\n        <div className='backtohome'><FaArrowCircleLeft /></div></Link>\r\n\r\n\r\n\r\n\r\n    </>\r\n\r\n  );\r\n\r\n}\r\nexport default Message;"]},"metadata":{},"sourceType":"module"}